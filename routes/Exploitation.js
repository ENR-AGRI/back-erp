const express = require("express");
const router = express.Router();
const { Exploitation } = require("../models/Exploitation");

const asyncMiddleware = require("../middleware/async");

router.post(
  "/exploitation",

  asyncMiddleware(async (req, res) => {
    let exploitations = await Exploitation.findOne();

    // if (donnees)
    //   return res.status(400).json({
    //     msgsrv: `already registered.`,
    //   });

    exploitations = new Exploitation(req.body);
    exploitations = await exploitations.save();

    res.send(exploitations);
  })
);
router.post(
  "/updateexploitation/:id",

  async (req, res) => {
    const exploitations = await Exploitation.findByIdAndUpdate(
      req.params.id,
      { ...req.body },
      { new: true }
    );

    if (!exploitations)
      return res
        .status(404)
        .send("The conception with the given ID was not found.");

    res.send(exploitations);
  }
);

router.get(
  "/getexploitations",
  asyncMiddleware(async (req, res) => {
    const exploitations = await Exploitation.find();
    //  result = JSON.parse(JSON.stringify(fiche))

    res.send(exploitations);
  })
);
module.exports = router;
